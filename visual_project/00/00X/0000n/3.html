
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>dates</title>
</head>


<style>

    .linestyle{
        fill:none;
        stroke:white;
        stroke-width:1px;

    }

    .labeltext0 {
        font-size: 16px ;
        font-family: Arial;
        font-weight:bold;
        fill:#000001;
    }

    .ycpc {
        font-size: 9px ;
        font-family: Arial;
        font-weight:bold;
        fill:#e64626;
    }

    .ncpc {
        font-size: 9px ;
        font-family: Arial;
        font-weight:bold;
        fill:#0148A4;
    }


    .axis0 path,

    .axis0 line{
        fill: none;
        stroke: black;
        shape-rendering: crispEdges;
    }


    /*path   line    的    定义  都是一样,*/
    /*表明写到一起的!!!!!!!*/


    .axis0 text {
        font-family: Arial;
        font-size: 5px;
        fill:black;
    }


    .axis1 path,

    .axis1 line{
        fill: none;
        stroke: black;
        shape-rendering: crispEdges;
    }


    /*path   line    的    定义  都是一样,*/
    /*表明写到一起的!!!!!!!*/


    .axis1 text {
        font-family: Arial;
        font-size: 11px;
        fill:#FFB800;
    }





    .MyRect {
        fill: steelblue;
    }

    .MyText {
        fill: white;
        text-anchor: middle;

    }




    .tooltip{
        position: absolute;
        width: auto;

        height: auto;
        font-family: Arial;
        font-size: 14px;
        text-align: center;
        border-style: dashed;
        border-width: 2px;
        background-color: white;
        border-radius: 7px;
    }






    .tooltip0{

        position: absolute;
        width: 8%;

        height: 7%;
        font-family: Arial;
        font-size: 14px;
        text-align: center;
        border-style: solid;
        border-width: 2px;
        background-color: white;
        border-radius: 5px;

    }





    .nodetext {
        font-size: 12px ;
        font-family: SimSun;
        fill:#000000;
    }





</style>






<body>

<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="unique.js" charset="utf-8"></script>
<script src="outputSim.js" charset="utf-8"></script>

<script>




    var width = 900;
    var height = 600;



    var color = d3.scale.category20();



    var svg = d3.select("body").append("svg")
            .attr("width",width)
            .attr("height",height);


    //========================================================================================




    d3.json("/WebstormProjects/summer/00/00X/0000n/author.json",function(error,root) {



        if (error) {
            return console.log(error);
        }
        console.log(root);

        var u = window.location.href;
        var ur = u.split('?')[1];
        var url = ur.split('=')[1];
        console.log(url);

        var ccl=url.split('&')[0];

        console.log(ccl);

        var urlf = ccl.replace(/_/g, ' ');
        console.log(urlf);


        svg.append("rect")
                .attr("width", urlf.length * 8.6)
                .attr("height", 20)
                .attr("fill", "#e64626")
                .attr('transform', 'translate(0,5)')
        ;


        var label = svg.append("text")
                .attr("class", "labeltext0")

                .attr("x", 0)
                .attr("y", 20)
                .text(urlf)
                ;



        //-----------------------------------------------------------------------------------------

        svg.append("line")
                .style("stroke","#424242")
                .style("stroke-width","2")
                .attr("x1",50)
                .attr("y1",325)
                .attr("x2",830)
                .attr("y2",325);


        svg.append("line")
                .style("stroke","#424242")
                .style("stroke-width","2")
                .attr("x1",50)
                .attr("y1",230)
                .attr("x2",830)
                .attr("y2",230);

        svg.append("line")
                .style("stroke","#424242")
                .style("stroke-width","2")
                .attr("x1",50)
                .attr("y1",135)
                .attr("x2",830)
                .attr("y2",135);

        svg.append("line")
                .style("stroke","#424242")
                .style("stroke-width","2")
                .attr("x1",50)
                .attr("y1",40)
                .attr("x2",830)
                .attr("y2",40);


//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

        var adiv = d3.select("body").append("img")
                //.attr("href","/WebstormProjects/summer/00/00X/0000.html?=Simpson__Stephen")
                .style("background-color","red")
                .style("left","850px")
                .style("top","10px")
                .style("color","red")
                .attr("class","tooltip0")
                //                .attr("href","/WebstormProjects/summer/00/00X/0000.html?=Simpson__Stephen")
                //这一行的意义???????????
                //这一行的意思??????????
                //???????????????????
                //????????????????????
                //????????????????????
                //???????????????????
                .attr("src","/WebstormProjects/summer/images/option.png")
                .on('click', function(d,i){
                    console.log(document.referrer);
                    window.location.href=document.referrer;
                })
                ;

        svg.append("svg:image")
                .attr('x',845)
                .attr('y',100)
                .attr('width', 9)
                .attr('height', 9)
                .attr("xlink:href","/WebstormProjects/summer/images/red.png")

        var ycpc = svg.append("text")
                .attr("class", "ycpc")
                .attr("x", 860)
                .attr("y", 107)
                .text("CPC")
                ;



        svg.append("svg:image")
                .attr('x',845)
                .attr('y',130)
                .attr('width', 9)
                .attr('height', 9)
                .attr("xlink:href","/WebstormProjects/summer/images/blue.png");

        var ncpc = svg.append("text")
                .attr("class", "ncpc")
                .attr("x", 860)
                .attr("y", 137)
                .text("Non CPC")
                ;



//    a.append("img").attr("border","1").attr("src","/WebstormProjects/summer/images/option.png")
//            .attr("width","150")
//            .attr("height","150").attr('transform', 'translate(500,100)');

        var tooltip = d3.select("body")
                .append("div")
                .attr("class","tooltip")
                .style("opacity",0.0);

//--------------------------------------------------------------------------------------------


        var y=[];
        var t0=[];//2011
        var t1=[];//2012
        var t2=[];//2013
        var t3=[];//2014
        var s=[];
        var m=[];


        var counterdate=0;
        var countertitle=0;
        var countersim=0;
        var countermatch=0;


        for (i = 0; i < root.length; i++) {

            //把提取出来的  年份放入一个数组, 以便写 X轴
            //把提取出来的  co-author 放入一个数组, 以便  写  y轴
            //根据   横坐标 与  纵坐标  来  加点?
            //加线是加+    invisible 的线??????

            //在老师画的图的那个地方!!!
            //要把   例如  2013年具体是什么项目给想办法表示出来

            //像直方图那样,  数据转化后已经有 x轴的具体坐标了
            //那就   访问进 x轴的坐标
            //+
            //到时候再访问进y轴的坐标
            //就获得了 点的坐标!!!!========
            //====想添加点
            //====就参考     散点图!!!!!!!!!!!!!


            //date 最大也就是到了 2011 ~~~~~2014


            var n=root[i]["Name"].replace(/,/g, ' ');
            console.log(n);


            if (urlf == root[i]["Name"].replace(/,/g, ' ')) {
                y.push(   {"mi": counterdate, "date": root[i]["Year"] , "title": root[i]["Title"],
                    "sim": root[i]["SimplAuth"],  "match": root[i]["MatchCPC"]}  );
                counterdate = counterdate + 1;

            };
//



        }

        console.log(y);

//x轴坐标    date
//为每一个都 弄成   [2011, 2012,2013, 2014]
//tickFormat 来制定  文字  格式!!!



        var timeset= [2011, 2012,2013, 2014];


        for(ii in y){
            if(y[ii]["date"]==2011) {
                t0.push(y[ii]);
            }
            else if(y[ii]["date"]==2012){
                t1.push(y[ii]);
            }
            else if(y[ii]["date"]==2013){
                t2.push(y[ii]);
            }
            else if (y[ii]["date"]==2014){
                t3.push(y[ii]);
            }

        }

        console.log(t0);//2011年的
        console.log(t1);//2012
        console.log(t2);//2013
        console.log(t3);//2014



        //把4个数组中所有的author加起来, 可能会有重复得!!!!
        //要把重复的去掉




//创建x轴,y轴
//----------------------------------------------------------------------------------------



        var yz0=[];

        for(i=0;i<t0.length;i++){
            yz0.push(t0[i]["sim"]);

        }

        console.log(yz0);

//***************************************************************************************
        var yz1=[];

        for(i=0;i<t1.length;i++){
            yz1.push(t1[i]["sim"]);

        }

        console.log(yz1);


//{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{{
        var yzyy1=[];//12年!!!!

        for(i=0;i<t1.length;i++){
            yzyy1.push({"sim":t1[i]["sim"],"match":t1[i]["match"]});

        }

        console.log(yzyy1);

//}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}




//***************************************************************************************



        var yz2=[];

        for(i=0;i<t2.length;i++){
            yz2.push(t2[i]["sim"]);

        }

        console.log(yz2);


        var yz3=[];

        for(i=0;i<t3.length;i++){
            yz3.push(t3[i]["sim"]);

        }

        console.log(yz3);



        var k0= yz0.concat(yz1);
        var k1=k0.concat(yz2);
        var k2=k1.concat(yz3);
        console.log(k2.length);


        var ky=unique(k2);
        console.log(ky.length)  ;
        console.log(ky);

        ky.unshift(" ");//!!!!!!!!!!!!!!!!!!!
//http://stackoverflow.com/questions/8073673/how-can-i-add-new-array-elements-at-the-beginning-of-an-array-in-javascript



        var formatDay = function(d) {
            return      ky[d];
        }



//        var formatDay = function(d) {
//            return outputSim(ky[1]);
//        }






        var padding = {left:50, right:10, top:20, bottom:20};


        var xScale = d3.scale.ordinal()

                .domain(d3.range(ky.length+1))

                //                .rangeRoundBands([0, width - padding.left - padding.right])
                .rangePoints([0,780])

                ;


        var xAxis = d3.svg.axis()
                .scale(xScale)
                .orient("bottom")
                .tickFormat(formatDay)
                ;



        svg.append("g")
                .attr("class","axis0")

                .attr("transform","translate(" + padding.left + "," + 420 + ")")
                .call(xAxis)
                .selectAll("text")
                .style("text-anchor", "start")
                //                .attr("dx", "-.558em")
                //                .attr("dy", ".15em")
                .attr("dx", "10")
                .attr("dy", "-7")
                .attr("transform", "rotate(90)")
//                .selectAll("text")
//                .style("text-anchor", "end")
//                .attr("dx", "-.8em")
//                .attr("dy", ".15em")
//                .attr("transform", "rotate(-85)")

//                .append("text")
//                .attr("class","ycpc")
//                .attr("transform", "rotate(-90)")
//                .text(function (d,i) {
//                    return ky[i]
//                })

        ;






//=========================================================================================



        var dates = ["11","12","13","14","15"];

        var formatDate = function(d) {
            return  "20" +  dates[d % 7] ;
        }




        var yScale = d3.scale.linear()

                .domain([0,dates.length-1])
                .range([380, 0]);





        var yAxis = d3.svg.axis()
                .scale(yScale)
                .orient("left")
                //                .ticks(ky.length)//控制有多少个刻度!!!!
                .ticks(dates.length)
                //                .ticks(7)
                //                .tickFormat(formatDay)
                .tickFormat(formatDate)


                ;// 制定y轴的刻度的方向是向左



        svg.append("g")
                .attr("class","axis1")
                .attr("transform","translate(" + padding.left + "," + 40 + ")")
                .call(yAxis);

//-----------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------


        console.log(t0);//2011年的
        console.log(t1);//2012
        console.log(t2);//2013
        console.log(t3);//2014

//-----------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------
//#########################################################################################
//########################################################################################
//        .domain(d3.range(5))
//        .rangePoints([0,380])
//        5个数 4个间隔!!!!!!!!
//        所以每一个间隔 都是  380/4=95
//        从(50,420)开始的!!!!!!




        t1.sort(function(a,b){
            //因为是在比较对象, 所有要加  comparator
            //如果是string的话. 就直接用  sort()
            //因为这个地方  root里面的东西全都是 object
            //所有要自己写comparator


            if (a["title"]>b["title"])
                return 1;
            else if (a["title"]<b["title"])
                return -1;
            else
                return 0;

        });

        console.log(t1);


        var TitleResults={};
        //创建一个字典

        for(zz in t1){
            var title=t1[zz]["title"];
            //不处理的话, 一些title最后面有空格
            //就是自动多加引号
            if (TitleResults[title]==undefined)
                TitleResults[title]=t1[zz]["sim"];



            else
                TitleResults[title]=TitleResults[title]+','+t1[zz]["sim"];

        }


        console.log(TitleResults);//从这里title已经没有再重复的了
        //属于   同一个title 下的sim 都在一个类中





        var tttt=[];

        var arraye=[];
        for(key in TitleResults) {
            if(TitleResults.hasOwnProperty(key)) {

                value=TitleResults[key].split(",");

                //do something with value;
                tttt.push(      {"title":key ,"sim":value   }      )

            }
        }


        //tttt中的这里title也没有重复的了
        //这是为了添加属性而已
//console.log(key);
////console.log(arraye);
//        console.log(value);
        console.log(tttt);



        var gap12=95/(tttt.length+1)
        console.log(gap12);

//=======================================================================================
//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
        //ky的第一个数, 是添加了一个 空的字符窜的!!!!


//"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
//"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
        var kvArray = [{key:1, value:10}, {key:2, value:20}, {key:3, value: 30}];
        var reformattedArray = kvArray.map(function(obj){
            var rObj = {};
            rObj[obj.key] = obj.value;
            return rObj;
        });

// map后接的就是一个  function!! 这个function里面的参数
//就是对应 KvArray 里面的每一个     元素
//一个一个遍历的来
//第一个元素.key 取得   1     第一个元素.value 取 10!!!!




//"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
//"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""


        var coor12={};  //这个是来  保存  所有   人的坐标

        console.log(ky);

        for(ll=1; ll<ky.length;ll++){
            coor12[ky[ll]]={"x":(780/ky.length)*ll+50,"y":420 };
        }

//  这里

        var axisx=[];

        for(xx=1; xx<ky.length;xx++) {
            axisx.push((780 / ky.length) * xx + 50)
        };

        var xxx =svg.selectAll("linexxx")
                .data(axisx)
                .enter()
                .append("line")
                .attr("class","linestyle")
                .attr("y1",40)
                .attr("x1",function(d){
                    return d;
                })
                .attr("y2",420)
                .attr("x2",function(d){
                    return d;
                })

                //
                .on("mouseover",function(d,i){

                    d3.select(this)
                            .style("stroke","#FFB800");

                })

                .on("mouseout",function(d,i){

                    d3.select(this)
                            .transition()
                            .duration(1000)
                            .delay(1000)
                            .style("stroke","white");

                })
                ;







        yyyy=[];

        projectYcoords={};
        var ymax=40+95*2;
        for (indext in tttt){
            console.log(indext);
            projectYcoords[tttt[indext].title]=ymax+gap12*(indext*1+1);
            //   这个地方  indext是一个string!!!!!!!!!!!!
            //!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

        }
//        size=0;
//        for (key in projectYcoords) {
//            if (projectYcoords.hasOwnProperty(key)) size++;
//        }
//        console.log(size);
        for (onePerson in t1){
            yyyy.push({"sim":t1[onePerson]["sim"],
                "projectTitle":t1[onePerson]["title"],"match":t1[onePerson]["match"],cx:coor12[t1[onePerson]["sim"]].x,
                cy:projectYcoords[t1[onePerson]["title"]]});
        }

        console.log(yyyy);



        ver12=[];


        var ymax=40+95*2;
        for (indext in tttt){
            console.log(indext);
            ver12.push( ymax+gap12*(indext*1+1));
            //   这个地方  indext是一个string!!!!!!!!!!!!
            //!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

        }



        var line12 =svg.selectAll("line12")
                .data(ver12)
                .enter()
                .append("line")
                .attr("class","linestyle")
                .attr("x1",50)
                .attr("y1",function(d){
                    return d;
                })
                .attr("x2",830)
                .attr("y2",function(d){
                    return d;
                })

                //
                .on("mouseover",function(d,i){

                    d3.select(this)
                            .style("stroke","#FFB800");

                })

                .on("mouseout",function(d,i){

                    d3.select(this)
                            .transition()
                            .duration(2000)
                            .delay(1000)
                            .style("stroke","white");

                })
                ;






// 2012年   yyyy  这个数组操作出来了!!!!!!!!

//        console.log(yyyy[0]["cx"]);
        var cicle12= svg.selectAll("circle12")
                .data(yyyy)
                .enter()
                .append("circle")
                .attr("cx",function(d,i){ return d.cx; })
                .attr("cy",function(d,i){ return d.cy; })

                .attr("r",1.6)



                .on("mouseover",function(d,i){


                    tooltip.html("<b style='color:red'>Title</b>"+":"+" "+"'" + d.projectTitle +"'"+"<br>"+
                                    "<b style='color:red'>Members</b>" + ":"+" "+ "<br>"+ d.sim
                            )

                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY + 2) + "px")
                            .style("opacity", 1.0);

                    //  鼠标停留在那 , 就会 弹出一个  框来!


                    d3.select(this)
                            .style("opacity", 0.5);


                })

                .on("mousemove",function(d,i){
                    /* 鼠标移动时，更改样式 left 和 top 来改变提示框的位置 */

                    tooltip.style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY + 20) + "px");
                })


                .on("mouseout",function(d,i){

                    d3.select(this)
                            .style("opacity",1);




                    tooltip.style("opacity",0.0);



                })




                //        .attr("fill","#0148A4")
                .attr("fill",function(d,i){
                    if (d.match=="TRUE"){

                        return "#e64626"

                    }
                    else{
                        return "#0148A4"
                    }


                })

                ;
//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++


        t0.sort(function(a,b){
            //因为是在比较对象, 所有要加  comparator
            //如果是string的话. 就直接用  sort()
            //因为这个地方  root里面的东西全都是 object
            //所有要自己写comparator


            if (a["title"]>b["title"])
                return 1;
            else if (a["title"]<b["title"])
                return -1;
            else
                return 0;

        });

        console.log(t0);


        var TitleResults11={};
        //创建一个字典

        for(zz in t0){
            var title=t0[zz]["title"];
            //不处理的话, 一些title最后面有空格
            //就是自动多加引号
            if (TitleResults11[title]==undefined)
                TitleResults11[title]=t0[zz]["sim"];



            else
                TitleResults11[title]=TitleResults11[title]+','+t0[zz]["sim"];

        }


        console.log(TitleResults11);//从这里title已经没有再重复的了
        //属于   同一个title 下的sim 都在一个类中





        var tttt11=[];

        var arraye=[];
        for(key in TitleResults11) {
            if(TitleResults11.hasOwnProperty(key)) {

                value=TitleResults11[key].split(",");

                //do something with value;
                tttt11.push(      {"title":key ,"sim":value   }      )

            }
        }


        //tttt中的这里title也没有重复的了
        //这是为了添加属性而已
//console.log(key);
////console.log(arraye);
//        console.log(value);
        console.log(tttt11);



        var gap11=95/(tttt11.length+1)
        console.log(gap11);

//=======================================================================================
//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
        //ky的第一个数, 是添加了一个 空的字符窜的!!!!


//"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
//"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
        var kvArray = [{key:1, value:10}, {key:2, value:20}, {key:3, value: 30}];
        var reformattedArray = kvArray.map(function(obj){
            var rObj = {};
            rObj[obj.key] = obj.value;
            return rObj;
        });

// map后接的就是一个  function!! 这个function里面的参数
//就是对应 KvArray 里面的每一个     元素
//一个一个遍历的来
//第一个元素.key 取得   1     第一个元素.value 取 10!!!!




//"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
//"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""


        var coor11={};  //这个是来  保存  所有   人的坐标

        console.log(ky);

        for(ll=1; ll<ky.length;ll++){
            coor11[ky[ll]]={"x":(780/ky.length)*ll+50,"y":420 };
        }

//  这里




        yyyy11=[];

        projectYcoords11={};
        var ymax11=40+95*3;
        for (indext in tttt11){
            console.log(indext);
            projectYcoords[tttt11[indext].title]=ymax11+gap11*(indext*1+1);
            //   这个地方  indext是一个string!!!!!!!!!!!!
            //!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

        }
//        size=0;
//        for (key in projectYcoords) {
//            if (projectYcoords.hasOwnProperty(key)) size++;
//        }
//        console.log(size);
        for (onePerson in t0){
            yyyy11.push({"sim":t0[onePerson]["sim"], "projectTitle":t0[onePerson]["title"],"match":t0[onePerson]["match"],cx:coor11[t0[onePerson]["sim"]].x,
                cy:projectYcoords[t0[onePerson]["title"]]});
        }

        console.log(yyyy11);



        ver11=[];


        var ymax11=40+95*3;
        for (indext in tttt11){
            console.log(indext);
            ver11.push( ymax11+gap11*(indext*1+1));
            //   这个地方  indext是一个string!!!!!!!!!!!!
            //!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

        }

        console.log(ver11);

        var line11 =svg.selectAll("line11")
                .data(ver11)
                .enter()
                .append("line")
                .attr("class","linestyle")
                .attr("x1",50)
                .attr("y1",function(d){
                    return d;
                })
                .attr("x2",830)
                .attr("y2",function(d){
                    return d;
                })

                //
                .on("mouseover",function(d,i){

                    d3.select(this)
                            .style("stroke","#FFB800");

                })

                .on("mouseout",function(d,i){

                    d3.select(this)
                            .transition()
                            .duration(2000)
                            .delay(1000)
                            .style("stroke","white");

                })
                ;






// 2012年   yyyy  这个数组操作出来了!!!!!!!!

//        console.log(yyyy[0]["cx"]);
        var cicle11= svg.selectAll("circle11")
                .data(yyyy11)
                .enter()
                .append("circle")
                .attr("cx",function(d,i){ return d.cx; })
                .attr("cy",function(d,i){ return d.cy; })

                .attr("r",1.6)



                .on("mouseover",function(d,i){


                    tooltip.html("<b style='color:red'>Title</b>"+":"+" "+"'" + d.projectTitle +"'"+"<br>"+
                                    "<b style='color:red'>Members</b>" + ":"+" "+ "<br>"+ d.sim
                            )

                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY + 2) + "px")
                            .style("opacity", 1.0);

                    //  鼠标停留在那 , 就会 弹出一个  框来!


                    d3.select(this)
                            .style("opacity", 0.5);


                })

                .on("mousemove",function(d,i){
                    /* 鼠标移动时，更改样式 left 和 top 来改变提示框的位置 */

                    tooltip.style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY - 100) + "px");
                })


                .on("mouseout",function(d,i){

                    d3.select(this)
                            .style("opacity",1);




                    tooltip.style("opacity",0.0);



                })




                //        .attr("fill","#0148A4")
                .attr("fill",function(d,i){
                    if (d.match=="TRUE"){

                        return "#e64626"

                    }
                    else{
                        return "#0148A4"
                    }


                })

                ;


//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++


        t2.sort(function(a,b){
            //因为是在比较对象, 所有要加  comparator
            //如果是string的话. 就直接用  sort()
            //因为这个地方  root里面的东西全都是 object
            //所有要自己写comparator


            if (a["title"]>b["title"])
                return 1;
            else if (a["title"]<b["title"])
                return -1;
            else
                return 0;

        });




        var TitleResults13={};
        //创建一个字典

        for(zz in t2){
            var title=t2[zz]["title"];
            //不处理的话, 一些title最后面有空格
            //就是自动多加引号
            if (TitleResults13[title]==undefined)
                TitleResults13[title]=t2[zz]["sim"];



            else
                TitleResults13[title]=TitleResults13[title]+','+t2[zz]["sim"];

        }


        console.log(TitleResults13);//从这里title已经没有再重复的了
        //属于   同一个title 下的sim 都在一个类中





        var tttt13=[];


        for(key in TitleResults13) {
            if(TitleResults13.hasOwnProperty(key)) {

                value=TitleResults13[key].split(",");

                //do something with value;
                tttt13.push(      {"title":key ,"sim":value   }      )

            }
        }


        //tttt中的这里title也没有重复的了
        //这是为了添加属性而已
//console.log(key);
////console.log(arraye);
//        console.log(value);










        var gap13=95/(tttt13.length+1)
        console.log(gap13);



//=======================================================================================
//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
        //ky的第一个数, 是添加了一个 空的字符窜的!!!!


//"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
//"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""



//"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
//"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""


        var coor13={};  //这个是来  保存  所有   人的坐标

        console.log(ky);

        for(ll=1; ll<ky.length;ll++){
            coor13[ky[ll]]={"x":(780/ky.length)*ll+50,"y":420 };
        }

//  这里




        yyyy13=[];

        projectYcoords13={};
        var ymax13=40+95*1;
        for (indext in tttt13){
            console.log(indext);
            projectYcoords[tttt13[indext].title]=ymax13+gap13*(indext*1+1);
            //   这个地方  indext是一个string!!!!!!!!!!!!
            //!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

        }
//        size=0;
//        for (key in projectYcoords) {
//            if (projectYcoords.hasOwnProperty(key)) size++;
//        }
//        console.log(size);

        console.log(t2);

        for (onePerson in t2){
            yyyy13.push({ "sim":t2[onePerson]["sim"],    "projectTitle":t2[onePerson]["title"],"match":t2[onePerson]["match"],cx:coor13[t2[onePerson]["sim"]].x,
                cy:projectYcoords[t2[onePerson]["title"]]});
        }

        console.log(yyyy13);




        ver13=[];


        var ymax13=40+95*1;
        for (indext in tttt13){
            console.log(indext);
            ver13.push( ymax13+gap13*(indext*1+1));
            //   这个地方  indext是一个string!!!!!!!!!!!!
            //!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

        }

        console.log(ver13);

        var line13 =svg.selectAll("line13")
                .data(ver13)
                .enter()
                .append("line")
                .attr("class","linestyle")
                .attr("x1",50)
                .attr("y1",function(d){
                    return d;
                })
                .attr("x2",830)
                .attr("y2",function(d){
                    return d;
                })

//
                .on("mouseover",function(d,i){

                    d3.select(this)
                            .style("stroke","#FFB800");

                })

                .on("mouseout",function(d,i){

                    d3.select(this)
                            .transition()
                            .duration(2000)
                            .delay(1000)
                            .style("stroke","white");

                })
                ;








//        console.log(yyyy[0]["cx"]);
        var cicle13= svg.selectAll("circle13")
                .data(yyyy13)
                .enter()
                .append("circle")
                .attr("cx",function(d,i){ return d.cx; })
                .attr("cy",function(d,i){ return d.cy; })

                .attr("r",1.6)



                .on("mouseover",function(d,i){



                    tooltip.html("<b style='color:red'>Title</b>"+":"+" "+"'" + d.projectTitle +"'"+"<br>"+
                                    "<b style='color:red'>Members</b>" + ":"+" "+ "<br>"+ d.sim
                            )
                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY + 2) + "px")
                            .style("opacity", 1.0);

                    //  鼠标停留在那 , 就会 弹出一个  框来!


                    d3.select(this)
                            .style("opacity", 0.5);


                })
//
                .on("mousemove",function(d,i){
                    /* 鼠标移动时，更改样式 left 和 top 来改变提示框的位置 */

                    tooltip.style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY + 20) + "px");
                })


                .on("mouseout",function(d,i){

                    d3.select(this)
                            .style("opacity",1);




                    tooltip.style("opacity",0.0);



                })




                //        .attr("fill","#0148A4")
                .attr("fill",function(d,i){
                    if (d.match=="TRUE"){

                        return "#e64626"

                    }
                    else{
                        return "#0148A4"
                    }


                })

                ;



//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++


        t3.sort(function(a,b){
            //因为是在比较对象, 所有要加  comparator
            //如果是string的话. 就直接用  sort()
            //因为这个地方  root里面的东西全都是 object
            //所有要自己写comparator


            if (a["title"]>b["title"])
                return 1;
            else if (a["title"]<b["title"])
                return -1;
            else
                return 0;

        });




        var TitleResults14={};
        //创建一个字典

        for(zz in t3){
            var title=t3[zz]["title"];
            //不处理的话, 一些title最后面有空格
            //就是自动多加引号
            if (TitleResults14[title]==undefined)
                TitleResults14[title]=t3[zz]["sim"];



            else
                TitleResults14[title]=TitleResults14[title]+','+t3[zz]["sim"];

        }


        console.log(TitleResults14);//从这里title已经没有再重复的了
        //属于   同一个title 下的sim 都在一个类中





        var tttt14=[];


        for(key in TitleResults14) {
            if(TitleResults14.hasOwnProperty(key)) {

                value=TitleResults14[key].split(",");

                //do something with value;
                tttt14.push(      {"title":key ,"sim":value   }      )

            }
        }


        //tttt中的这里title也没有重复的了
        //这是为了添加属性而已
//console.log(key);
////console.log(arraye);
//        console.log(value);




        var gap14=95/(tttt14.length+1)
        console.log(gap14);

//=======================================================================================
//+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
        //ky的第一个数, 是添加了一个 空的字符窜的!!!!


//"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
//"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
        var kvArray = [{key:1, value:10}, {key:2, value:20}, {key:3, value: 30}];
        var reformattedArray = kvArray.map(function(obj){
            var rObj = {};
            rObj[obj.key] = obj.value;
            return rObj;
        });

// map后接的就是一个  function!! 这个function里面的参数
//就是对应 KvArray 里面的每一个     元素
//一个一个遍历的来
//第一个元素.key 取得   1     第一个元素.value 取 10!!!!




//"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
//"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""


        var coor14={};  //这个是来  保存  所有   人的坐标

        console.log(ky);

        for(ll=1; ll<ky.length;ll++){
            coor14[ky[ll]]={"x":(780/ky.length)*ll+50,"y":420 };
        }

//  这里









        yyyy14=[];

        projectYcoords14={};
        var ymax14=40+95*0;
        for (indext in tttt14){
            console.log(indext);
            projectYcoords[tttt14[indext].title]=ymax14+gap14*(indext*1+1);
            //   这个地方  indext是一个string!!!!!!!!!!!!
            //!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

        }
//        size=0;
//        for (key in projectYcoords) {
//            if (projectYcoords.hasOwnProperty(key)) size++;
//        }
//        console.log(size);
        for (onePerson in t3){
            yyyy14.push({ "sim":t3[onePerson]["sim"], "projectTitle":t3[onePerson]["title"],"match":t3[onePerson]["match"],cx:coor14[t3[onePerson]["sim"]].x,
                cy:projectYcoords[t3[onePerson]["title"]]});
        }

        console.log(yyyy14);





        ver14=[];


        var ymax14=40+95*0;
        for (indext in tttt14){
            console.log(indext);
            ver13.push( ymax14+gap14*(indext*1+1));
            //   这个地方  indext是一个string!!!!!!!!!!!!
            //!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

        }

        console.log(ver14);

        var line14 =svg.selectAll("line14")
                .data(ver14)
                .enter()
                .append("line")
                .attr("class","linestyle")
                .attr("x1",50)
                .attr("y1",function(d){
                    return d;
                })
                .attr("x2",830)
                .attr("y2",function(d){
                    return d;
                })

                //
                .on("mouseover",function(d,i){

                    d3.select(this)
                            .style("stroke","#FFB800");

                })

                .on("mouseout",function(d,i){

                    d3.select(this)
                            .transition()
                            .duration(2000)
                            .delay(1000)
                            .style("stroke","white");

                })
                ;




// 2012年   yyyy  这个数组操作出来了!!!!!!!!

//        console.log(yyyy[0]["cx"]);

        var cicle14= svg.selectAll("circle14")
                .data(yyyy14)
                .enter()
                .append("circle")
                .attr("cx",function(d,i){ return d.cx; })
                .attr("cy",function(d,i){ return d.cy; })

                .attr("r",1.6)



                .on("mouseover",function(d,i){



                    tooltip.html("<b style='color:red'>Title</b>"+":"+" "+"'" + d.projectTitle +"'"+"<br>"+
                                    "<b style='color:red'>Members</b>" + ":"+" "+ "<br>"+ d.sim
                            )

                            .style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY + 2) + "px")
                            .style("opacity", 1.0);

                    //  鼠标停留在那 , 就会 弹出一个  框来!


                    d3.select(this)
                            .style("opacity", 0.5);


                })

                .on("mousemove",function(d,i){
                    /* 鼠标移动时，更改样式 left 和 top 来改变提示框的位置 */

                    tooltip.style("left", (d3.event.pageX) + "px")
                            .style("top", (d3.event.pageY + 20) + "px");
                })


                .on("mouseout",function(d,i){

                    d3.select(this)
                            .style("opacity",1);




                    tooltip.style("opacity",0.0);



                })




                //        .attr("fill","#0148A4")
                .attr("fill",function(d,i){
                    if (d.match=="TRUE"){

                        return "#e64626"

                    }
                    else{
                        return "#0148A4"
                    }


                })

                ;

















    })






</script>

</body>
</html> 
